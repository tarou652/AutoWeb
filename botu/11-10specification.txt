# Nuxt3コンテンツ自動生成システム 企画書（オンラインくじ初出対応）

---

## 1. 概要

本企画は、現在人手で行っているオンラインくじの初出のページやMJの更新などのコンテンツ追加作業をAWSによる自動化システムで置き換えるものです。  
Googleスプレッドシートを基盤とした情報管理と、画像アップロード機能を組み合わせ、人の作業を最小限（確認のみ）にすることを目的としています。

今回はオンラインくじの初出コンテンツ作成を想定して作成する。

---

## 2. 現状のフロー

| 項目 | 内容 |
|------|------|
| １ | 必要なデータやテキストをもらう |
| ２ | 直近の初出のフォルダをコピーして内容を変更する<br>→この時スプレッドシートからIDを持ってくる必要がある |
| ３ | 画像フォルダがあるのでそこも同じようにコピーして追加する |
| ４ | 表示が確認できたらジェネレートをする |
| ５ | git pushする |
| ６ | ジェネレートしたファイルをSyncしてサーバーにあげテストアップをする |

**問題点**  
- ヒューマンエラー発生  
- 更新作業の属人化  
- リードタイム増大

---

## 3. 目標

- 現在のフローのうち **２～３** をWEBアプリの中で実行できるようにする  
- ゆくゆくは拡張機能として **４と５** の流れもWEBアプリの中で完結させたい  

**目的**  
コンテンツのデザイン統一・反映速度の向上・作業コスト削減を実現する。

---

## 4. システム全体構成図


4. システム全体構成図
[管理者]
   │ 入力・画像アップロード
   ▼
[Webフォーム]
   │ API呼び出し
   ▼
Amazon API Gateway
   │
   ▼
AWS Lambda（Node.js）
   ├─ Google Sheets API：コンテンツ名・ID取得
   ├─ S3：画像保存・テンプレート取得
   ├─ GitHub API：Nuxt3プロジェクト更新・PR作成
   └─ Secrets Manager：APIキー・トークン管理


---

## 5. 処理フロー詳細

### ① コンテンツ情報取得
Googleスプレッドシートを基盤とし、  
**1列目＝コンテンツ名**, **2列目＝コンテンツID** を保持。  
LambdaがSheets APIを用いてIDを取得。

### ② 画像アップロード
管理者は簡易Webフォームで画像を選択・アップロード。  
Lambdaが発行する署名付きURLを通じてS3へ直接アップロード。  
ファイル名は `uploads/[コンテンツID].jpg` として一意管理。

### ③ 自動生成処理（Lambdaトリガー）
S3へのアップロード完了をトリガーにLambdaが起動。  
S3上の `template.vue` を読み込み、以下を置換：

- `${title}` → コンテンツ名  
- `${id}` → コンテンツID  
- `${image}` → `/images/[id].jpg`

GitHub APIを通じて次を自動実行：

1. 新しいブランチ作成（`auto/[id]`）  
2. `/public/images/[id].jpg` と `/content/articles/[id].vue` を追加  
3. 自動的にPull Requestを作成  

### ④ レビュー・公開
開発者または管理者がGitHub上でPRを確認。  
問題なければマージ。  
GitHub ActionsまたはAmplifyによってNuxt3サイトが自動デプロイ。

---

## 6. Nuxt3 側の構成

| ディレクトリ | 用途 |
|---------------|------|
| `/content/articles/` | 自動生成される各記事 `.vue` ファイル |
| `/public/images/` | 各記事に対応する画像ファイル |
| `/pages/articles/[id].vue` | NUXT Contentによる動的ルーティング対応 |

---

## 7. 使用技術一覧

| 分類 | 使用技術 | 用途 |
|------|------------|------|
| フロント | Nuxt3, HTML, JS | コンテンツ表示・静的生成 |
| AWS | Lambda, API Gateway, S3, Secrets Manager | 自動化ロジック・API連携 |
| 外部API | Google Sheets API | ID・タイトル取得 |
| バージョン管理 | GitHub + GitHub API | 自動PR・ブランチ操作 |
| 認証管理 | AWS Secrets Manager | GitHubトークン・Googleキーの保護 |

---

## 8. メリット

| 観点 | 効果 |
|------|------|
| 工数削減 | 1件あたり15分 → 1分未満に短縮 |
| 一貫性 | テンプレートベースの自動生成によりデザイン統一 |
| セキュリティ | APIキー・トークンをSecrets Managerで管理 |
| 品質 | 手動ミス削減、レビュー工程の明確化 |
| 拡張性 | テキスト・画像以外（動画・タグなど）の拡張も容易 |

---

## 9. 運用フロー（最終形）

1. 管理者がスプレッドシートにタイトルとIDを追加  
2. 画像アップロードページで該当コンテンツを選び画像をアップロード  
3. AWS Lambdaが自動でNuxt3ページを生成しPR作成  
4. 管理者がPRを確認してマージ  
5. Nuxt3サイトに自動反映  

---

## 10. 今後の拡張案

- スプレッドシートに「説明文」「タグ」列を追加し、メタ情報も自動生成  
- SlackやTeamsに「新しいPRが作成されました」通知を送る  
- Amplify Hosting連携で即時プレビュー環境を構築  
- Bedrock等AIを組み込み、文章自動生成も将来的に検討可能  

---

## 11. 導入ステップ

| フェーズ | 内容 | 期間（目安） |
|-----------|------|----------------|
| 設計 | フロー確定・S3/Sheets/Repo連携設定 | 1週間 |
| 実装 | Lambda, API Gateway, フロントフォーム | 2週間 |
| テスト | PR動作・画像確認 | 1週間 |
| 導入 | 運用マニュアル化・リリース | 1週間 |

---

## 12. まとめ

本システムにより、  
コンテンツ生成フローを自動化し、作業コストとリスクを大幅に削減できます。  
「テンプレート編集＋画像配置」を完全にAWSが代行し、  
担当者はスプレッドシート管理と最終確認に専念できるようになります。
